{% extends "base.html" %}
{% block content %}

<nav class="d-flex gap-2 flex-wrap mb-4">
  <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm">üè† Dashboard</a>
  <a href="{{ url_for('cotizador') }}" class="btn btn-outline-primary btn-sm">üí∞ Cotizador</a>
</nav>

<h2 class="mb-3">üìö Importar Cat√°logos</h2>

<!-- üîπ Formulario de importaci√≥n -->
<section class="panel mb-4 p-3 border rounded bg-white shadow-sm">
  <form action="{{ url_for('catalogos.import_catalogo') }}" method="POST" enctype="multipart/form-data">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label for="tipo" class="form-label">Tipo de Cat√°logo</label>
        <select name="tipo" id="tipo" class="form-select" required>
          <option value="">Seleccione...</option>
          <option value="Clientes">Clientes</option>
          <option value="Conceptos">Conceptos</option>
        </select>
      </div>
      <div class="col-md-5">
        <label for="archivo" class="form-label">Archivo CSV o XLSX</label>
        <input type="file" name="archivo" id="archivo" accept=".csv,.xlsx,.xls" class="form-control" required>
      </div>
      <div class="col-md-3 d-grid">
        <button type="submit" class="btn btn-success">üì§ Subir Cat√°logo</button>
      </div>
    </div>
  </form>
</section>

<!-- üîπ Mensajes Flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<hr class="my-4">

<!-- üîπ Tabla de Clientes -->
<h4 class="mb-3 text-primary">üßæ Cat√°logo de Clientes</h4>

{% if clientes %}
<div class="table-responsive mb-3">
  <table class="table table-sm table-hover table-bordered align-middle bg-white shadow-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th><th>Nombre</th><th>Empresa</th><th>Responsable</th>
        <th>Correo</th><th>Tel√©fono</th><th>RFC</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for c in clientes %}
      <tr>
        <td>{{ c.id }}</td>
        <td>{{ c.nombre_cliente }}</td>
        <td>{{ c.empresa or '' }}</td>
        <td>{{ c.responsable or '' }}</td>
        <td>{{ c.correo or '' }}</td>
        <td>{{ c.telefono or '' }}</td>
        <td>{{ c.rfc or '' }}</td>
        <td>
          <a href="{{ url_for('catalogos.eliminar_catalogo', tipo='clientes', item_id=c.id) }}" class="btn btn-outline-danger btn-sm">üóë Eliminar</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- üîπ Paginaci√≥n de Clientes -->
{% if clientes_pag.pages > 1 %}
<nav aria-label="Paginaci√≥n Clientes" class="mb-5">
  <ul class="pagination justify-content-center">
    {% if clientes_pag.has_prev %}
      <li class="page-item"><a class="page-link" href="?page_clientes={{ clientes_pag.prev_num }}">‚óÄ</a></li>
    {% endif %}
    {% for page in clientes_pag.iter_pages() %}
      {% if page %}
        <li class="page-item {% if page == clientes_pag.page %}active{% endif %}">
          <a class="page-link" href="?page_clientes={{ page }}">{{ page }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">‚Ä¶</span></li>
      {% endif %}
    {% endfor %}
    {% if clientes_pag.has_next %}
      <li class="page-item"><a class="page-link" href="?page_clientes={{ clientes_pag.next_num }}">‚ñ∂</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% else %}
<p class="text-muted">A√∫n no hay clientes registrados.</p>
{% endif %}

<hr class="my-4">

<!-- üîπ Tabla de Conceptos -->
<h4 class="mb-3 text-success">üß∞ Cat√°logo de Conceptos</h4>

{% if conceptos %}
<div class="table-responsive mb-3">
  <table class="table table-sm table-hover table-bordered align-middle bg-white shadow-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th><th>Concepto</th><th>Unidad</th><th>Precio Unitario</th><th>Descripci√≥n</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for c in conceptos %}
      <tr>
        <td>{{ c.id }}</td>
        <td>{{ c.nombre_concepto }}</td>
        <td>{{ c.unidad or '' }}</td>
        <td>${{ '%.2f'|format(c.precio_unitario or 0) }}</td>
        <td>{{ c.descripcion or '' }}</td>
        <td>
          <a href="{{ url_for('catalogos.eliminar_catalogo', tipo='conceptos', item_id=c.id) }}" class="btn btn-outline-danger btn-sm">üóë Eliminar</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- üîπ Paginaci√≥n de Conceptos -->
{% if conceptos_pag.pages > 1 %}
<nav aria-label="Paginaci√≥n Conceptos">
  <ul class="pagination justify-content-center">
    {% if conceptos_pag.has_prev %}
      <li class="page-item"><a class="page-link" href="?page_conceptos={{ conceptos_pag.prev_num }}">‚óÄ</a></li>
    {% endif %}
    {% for page in conceptos_pag.iter_pages() %}
      {% if page %}
        <li class="page-item {% if page == conceptos_pag.page %}active{% endif %}">
          <a class="page-link" href="?page_conceptos={{ page }}">{{ page }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">‚Ä¶</span></li>
      {% endif %}
    {% endfor %}
    {% if conceptos_pag.has_next %}
      <li class="page-item"><a class="page-link" href="?page_conceptos={{ conceptos_pag.next_num }}">‚ñ∂</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% else %}
<p class="text-muted">A√∫n no hay conceptos registrados.</p>
{% endif %}

<hr class="mt-5">
<div class="d-flex justify-content-end gap-2">
  <a href="{{ url_for('catalogos.export_clientes_csv') }}" class="btn btn-outline-primary btn-sm">‚¨á Exportar Clientes</a>
  <a href="{{ url_for('catalogos.export_conceptos_csv') }}" class="btn btn-outline-success btn-sm">‚¨á Exportar Conceptos</a>
</div>

{% endblock %}
