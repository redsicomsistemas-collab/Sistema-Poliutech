{% extends "base.html" %}
{% block content %}

<h2 class="mb-3">Nueva Cotización</h2>

<form action="{{ url_for('crear_cotizacion') }}" method="POST" autocomplete="off" class="panel">

  <!-- ===== Datos del cliente ===== -->
  <section class="mb-4">
    <h5>Datos del cliente</h5>
    <div class="row g-3">
      <div class="col-md-6 position-relative">
        <label class="form-label">Cliente</label>
        <input type="text" id="cliente_input" name="cliente_nombre" class="form-control" placeholder="Escribe para buscar o crear...">
        <div id="cliente_suggestions" class="list-group position-absolute w-100" style="z-index:1000; max-height:200px; overflow:auto;"></div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Empresa</label>
        <input type="text" id="empresa" name="empresa" class="form-control">
      </div>
      <div class="col-md-4">
        <label class="form-label">Responsable</label>
        <input type="text" id="responsable" name="responsable" class="form-control">
      </div>
      <div class="col-md-4">
        <label class="form-label">Correo</label>
        <input type="email" id="correo" name="correo" class="form-control">
      </div>
      <div class="col-md-4">
        <label class="form-label">Teléfono</label>
        <input type="text" id="telefono" name="telefono" class="form-control">
      </div>
      <div class="col-md-8">
        <label class="form-label">Dirección</label>
        <input type="text" id="direccion" name="direccion" class="form-control">
      </div>
      <div class="col-md-4">
        <label class="form-label">RFC</label>
        <input type="text" id="rfc" name="rfc" class="form-control">
      </div>
    </div>
  </section>

  <!-- ===== Conceptos ===== -->
  <section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="m-0">Conceptos</h5>
      <button type="button" class="btn btn-sm btn-outline-primary" id="btn-add-row">Agregar renglón</button>
    </div>

    <div class="table-responsive">
      <table class="table table-sm align-middle" id="tbl-items">
        <thead>
          <tr>
            <th>Concepto</th>
            <th>Unidad</th>
            <th>Cantidad</th>
            <th>Precio Unitario</th>
            <th>Sistema</th>
            <th>Subtotal</th>
          </tr>
        </thead>

        <tbody id="items-body"></tbody>
      </table>
    </div>
  </section>

  <!-- ===== Totales / Estatus ===== -->
  <section class="row g-3 mb-4">
    <div class="col-md-8">
      <label class="form-label">Notas</label>
      <textarea class="form-control" name="notas" rows="3"></textarea>
    </div>
    <div class="col-md-4">
      <div class="border rounded p-2 bg-light">
        <div class="d-flex justify-content-between">
          <span>Subtotal</span><strong id="ui-subtotal">$0.00</strong>
        </div>
        <div class="d-flex justify-content-between mt-2 align-items-center">
          <span>IVA (%)</span>
          <input type="number" step="0.01" class="form-control form-control-sm w-50" id="iva_porc" name="iva_porc" value="16">
        </div>
        <div class="d-flex justify-content-between mt-2">
          <span>IVA ($)</span><strong id="ui-iva">$0.00</strong>
        </div>
        <hr>
        <div class="d-flex justify-content-between">
          <span>Total</span><strong id="ui-total" class="fs-5">$0.00</strong>
        </div>
      </div>
    </div>
  </section>

  <section class="row g-3 mb-3">
    <div class="col-md-3">
      <label class="form-label">Estatus</label>
      <select name="estatus" class="form-select">
        <option value="PENDIENTE" selected>PENDIENTE</option>
        <option value="ENVIADA">ENVIADA</option>
        <option value="GANADA">GANADA</option>
        <option value="PERDIDA">PERDIDA</option>
      </select>
    </div>
  </section>

  <div class="text-end">
    <button type="submit" class="btn btn-primary px-4">Guardar Cotización</button>
  </div>
</form>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} mt-3">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<script src="{{ url_for('static', filename='js/cotizador.js') }}"></script>
{% endblock %}
